<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drachin - Drama Chino Stream</title>
    <meta name="description" content="Watch latest Chinese Drama for free.">
    <meta name="theme-color" content="#000000">
    
    <link rel="preconnect" href="https://www.dailymotion.com">
    <link rel="preconnect" href="https://api.dailymotion.com">
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/lucide@0.263.1/dist/umd/lucide.min.js"></script>

    <style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #e50914; }

        body { 
            background-color: #000; 
            color: #e5e5e5; 
            font-family: 'Segoe UI', Roboto, sans-serif; 
            /* ANTI-COPY CSS */
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .aspect-video-card {
            aspect-ratio: 16/9;
        }
        
        /* FIX VIDEO RESPONSIVE & RATIO */
        .video-container {
            position: relative;
            padding-bottom: 56.25%; /* 16:9 Aspect Ratio */
            height: 0;
            overflow: hidden;
            background-color: #000;
            width: 100%;
        }
        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        /* Container Iklan Native agar tidak layout shift (lompat) */
        .ad-native-container {
            min-height: 250px;
            background-color: #0a0a0a;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            overflow: hidden;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col font-sans" oncontextmenu="return false;">

    <nav class="sticky top-0 z-[60] bg-black/90 backdrop-blur-xl border-b border-white/5">
        <div class="container mx-auto px-4 h-14 md:h-16 flex items-center justify-between gap-4">
            <a href="?" class="flex items-center gap-2 text-2xl font-bold tracking-tighter hover:scale-105 transition shrink-0">
                <span class="text-red-600">â–¶</span> Drachin
            </a>
            
            <div class="flex items-center gap-3 flex-1 justify-end md:justify-between">
                <form id="searchForm" class="hidden md:flex flex-1 max-w-md mx-auto items-center bg-[#111] rounded-full px-4 py-1.5 border border-[#333] focus-within:border-red-600 transition">
                    <input type="text" id="searchInput" data-i18n-placeholder="searchPlaceholder" placeholder="Search drama or Paste ID..." class="bg-transparent border-none outline-none text-sm w-full text-white placeholder-gray-500">
                    <button type="submit" class="text-gray-400 hover:text-white"><i data-lucide="search" class="w-4 h-4"></i></button>
                </form>

                <div class="relative group">
                    <select id="langSelect" onchange="changeLanguage(this.value)" class="appearance-none bg-[#111] border border-[#333] text-white text-xs py-1.5 pl-3 pr-8 rounded-full focus:outline-none focus:border-red-600 cursor-pointer font-medium hover:bg-[#222] transition">
                        <option value="en">ðŸ‡ºðŸ‡¸ EN</option>
                        <option value="es">ðŸ‡ªðŸ‡¸ ES</option>
                    </select>
                    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-400">
                        <i data-lucide="chevron-down" class="w-3 h-3"></i>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <main class="flex-grow w-full max-w-[1400px] mx-auto">
        
        <div id="mobileSearchContainer" class="px-4 pt-4 pb-2 md:hidden">
            <form id="searchFormMobile" class="flex items-center bg-[#111] rounded-full px-4 py-2 border border-[#333]">
                 <input type="text" id="searchInputMobile" data-i18n-placeholder="searchPlaceholder" placeholder="Search drama..." class="bg-transparent border-none outline-none text-sm w-full text-white placeholder-gray-500">
                 <button type="submit" class="text-gray-400 hover:text-white"><i data-lucide="search" class="w-4 h-4"></i></button>
            </form>
        </div>

        <div id="loader" class="hidden flex justify-center items-center py-20">
            <div class="animate-spin rounded-full h-12 w-12 border-t-4 border-red-600 border-solid"></div>
        </div>

        <div id="homeView" class="px-4 py-6">
            <div class="flex items-center justify-between mb-6">
                <h2 id="pageTitle" class="text-xl md:text-2xl font-bold border-l-4 border-red-600 pl-3">Latest Chinese Dramas</h2>
            </div>
            
            <div id="videoGrid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3 md:gap-6">
                </div>
            
            <div class="mt-10 text-center">
                <button id="loadMoreBtn" onclick="loadMore()" class="px-8 py-3 bg-[#222] hover:bg-[#333] text-white rounded-full text-sm font-bold tracking-wide transition border border-[#333]">
                    Load More
                </button>
            </div>
        </div>

        <div id="playerView" class="hidden grid grid-cols-1 lg:grid-cols-3 gap-0 lg:gap-8 lg:p-6">
            <div class="lg:col-span-2 relative">
                
                <div class="sticky top-14 z-40 lg:static w-full bg-black shadow-2xl">
                    <div class="video-container lg:rounded-xl border-b border-white/10 lg:border-none">
                        <iframe id="dmPlayer" frameborder="0" allow="autoplay; fullscreen; picture-in-picture" playsinline webkit-playsinline allowfullscreen></iframe>
                    </div>
                </div>

                <div class="px-4 py-5 lg:px-0 bg-black lg:bg-transparent">
                    
                    <button onclick="goHome()" class="lg:hidden flex items-center text-gray-400 hover:text-white text-xs mb-3 transition uppercase tracking-wider font-semibold">
                        <i data-lucide="arrow-left" class="w-3 h-3 mr-1"></i> <span data-i18n="backBtn">Back to Home</span>
                    </button>

                    <h1 id="playerTitle" class="text-lg md:text-2xl font-bold leading-snug mb-2 text-white">Loading info...</h1>
                    
                    <div class="flex items-center gap-3 text-sm text-gray-400 mb-5 border-b border-white/10 pb-4">
                        <span class="bg-red-600 text-white px-2 py-0.5 rounded-sm text-[10px] font-bold tracking-wider">DM</span>
                        <span id="playerOwner" class="font-medium text-gray-300">...</span>
                        <span class="text-gray-600">â€¢</span>
                        <span id="playerViews">...</span>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-3 mb-6">
                        <a id="downloadBtn" href="https://thinnerwithdrewforbear.com/gcjm4sfz6e?key=f12b44e51f20fb37ba29ae6253bff65a" target="_blank" rel="nofollow" class="flex items-center justify-center gap-2 bg-[#222] hover:bg-[#333] text-white py-3 rounded-lg text-sm font-semibold transition border border-white/10">
                            <i data-lucide="download" class="w-4 h-4"></i> <span data-i18n="watchOnDm">Download</span>
                        </a>
                        <button onclick="shareVideo()" class="flex items-center justify-center gap-2 bg-red-600 hover:bg-red-700 text-white py-3 rounded-lg text-sm font-semibold transition active:scale-95 shadow-lg shadow-red-900/20">
                            <i data-lucide="share-2" class="w-4 h-4"></i> <span data-i18n="share">Share</span>
                        </button>
                    </div>

                    <div class="mb-8 p-1 bg-[#111] border border-white/5 rounded-lg">
                         <div class="text-[10px] text-gray-600 mb-2 text-center tracking-widest uppercase mt-2">Sponsored</div>
                         <div class="ad-native-container relative">
                             <script async="async" data-cfasync="false" src="https://thinnerwithdrewforbear.com/b94cafeb9a426597e421e6c2d836a415/invoke.js"></script>
                             <div id="container-b94cafeb9a426597e421e6c2d836a415"></div>
                         </div>
                    </div>

                    <div class="lg:hidden">
                        <h3 class="text-lg font-bold mb-4 text-white border-l-4 border-red-600 pl-3" data-i18n="recommendationTitle">More Like This</h3>
                        <div id="recommendationListMobile" class="grid grid-cols-2 gap-3">
                            </div>
                    </div>
                </div>
            </div>

            <div class="hidden lg:block lg:col-span-1">
                <button onclick="goHome()" class="flex items-center text-gray-400 hover:text-white text-sm mb-4 transition">
                    <i data-lucide="arrow-left" class="w-4 h-4 mr-1"></i> <span data-i18n="backBtn">Back</span>
                </button>
                <h3 class="text-lg font-bold mb-4 text-gray-200" data-i18n="recommendationTitle">Recommended</h3>
                <div id="recommendationListDesktop" class="flex flex-col gap-3">
                    </div>
            </div>
        </div>

    </main>

    <footer class="mt-12 py-8 bg-[#050505] border-t border-white/5 text-center relative">
        <p class="text-gray-500 text-sm">&copy; 2025 Drachin Stream.</p>
        
        <div style="margin-top: 10px; opacity: 0.8;">
            <script type="text/javascript">var _Hasync= _Hasync|| [];
            _Hasync.push(['Histats.start', '1,4654540,4,0,0,0,00010000']);
            _Hasync.push(['Histats.fasi', '1']);
            _Hasync.push(['Histats.track_hits', '']);
            (function() {
            var hs = document.createElement('script'); hs.type = 'text/javascript'; hs.async = true;
            hs.src = ('//s10.histats.com/js15_as.js');
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(hs);
            })();</script>
            <noscript><a href="/" target="_blank"><img  src="//sstatic1.histats.com/0.gif?4654540&101" alt="free web stats" border="0"></a></noscript>
        </div>
    </footer>

    <script>
        // === ANTI CLONE / ANTI COPY SCRIPT ===
        document.addEventListener('keydown', function(e) {
            if (e.key === 'F12' || 
               (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'J')) || 
               (e.ctrlKey && e.key === 'U')) {
                e.preventDefault();
                return false;
            }
        });
        document.addEventListener('contextmenu', event => event.preventDefault());


        // === CONFIG ===
        const CONFIG = {
            en: {
                query: "Chinese Drama Eng Sub",
                titleHome: "Latest Dramas",
                searchPlaceholder: "Search drama or ID...",
                loadMore: "Load More",
                backBtn: "Back",
                watchOnDm: "Download", 
                share: "Share",
                copied: "Link copied!",
                recommendationTitle: "More Like This",
                noResult: "No videos found.",
                loading: "Loading..."
            },
            es: {
                query: "Drama Chino Sub EspaÃ±ol",
                titleHome: "Dramas Recientes",
                searchPlaceholder: "Buscar drama o ID...",
                loadMore: "Cargar MÃ¡s",
                backBtn: "Volver",
                watchOnDm: "Descargar", 
                share: "Compartir",
                copied: "Â¡Copiado!",
                recommendationTitle: "MÃ¡s como esto",
                noResult: "No videos.",
                loading: "Cargando..."
            }
        };

        let currentLang = 'en'; 
        let currentPage = 1;
        let currentQuery = CONFIG[currentLang].query;
        let isSearchMode = false;
        
        const homeView = document.getElementById('homeView');
        const playerView = document.getElementById('playerView');
        const videoGrid = document.getElementById('videoGrid');
        const loader = document.getElementById('loader');
        const pageTitle = document.getElementById('pageTitle');
        const dmPlayer = document.getElementById('dmPlayer');
        const loadMoreBtn = document.getElementById('loadMoreBtn');
        const mobileSearchContainer = document.getElementById('mobileSearchContainer');
        
        function refreshIcons() {
            setTimeout(() => {
                if (typeof lucide !== 'undefined' && lucide.createIcons) lucide.createIcons();
            }, 100);
        }

        // === POPUNDER TIMER (5 MENIT - SAFE MODE) ===
        // Script baru akan dibuat setelah 300.000ms.
        // Pengunjung AMAN selama 5 menit pertama.
        let popunderLoaded = false;

        function initPopunder() {
            console.log("Ad Timer Started: 5 Minutes safety.");
            setTimeout(() => {
                if(popunderLoaded) return; // Mencegah double injection
                
                var script = document.createElement('script');
                script.type = 'text/javascript';
                script.src = 'https://thinnerwithdrewforbear.com/6d/d4/c7/6dd4c77770d65b1bcda88bbac1019b8a.js';
                
                // Error handling agar tidak merusak halaman jika adblock aktif
                script.onerror = function() { console.log("Ad Blocked or Error."); };
                
                document.body.appendChild(script);
                popunderLoaded = true;
                console.log("Popunder Script Armed (Ready on next click).");
            }, 300000); // 300 detik = 5 menit
        }

        function applyLanguageText(lang) {
            const textData = CONFIG[lang];
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if(textData[key]) el.innerText = textData[key];
            });
            document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
                const key = el.getAttribute('data-i18n-placeholder');
                if(textData[key]) el.placeholder = textData[key];
            });
            if (!isSearchMode) {
                pageTitle.innerText = textData.titleHome;
                currentQuery = textData.query;
            }
            loadMoreBtn.innerText = textData.loadMore;
        }

        function changeLanguage(lang) {
            currentLang = lang;
            applyLanguageText(lang);
            updateUrlState();
            if (playerView.classList.contains('hidden')) {
                currentPage = 1;
                videoGrid.innerHTML = '';
                loadHomeView();
            } else {
                loadRecommendations(getIdFromUrl() || 'x');
            }
        }

        async function init() {
            initPopunder(); 
            
            const urlParams = new URLSearchParams(window.location.search);
            const videoId = urlParams.get('id');
            const langParam = urlParams.get('lang');
            if (langParam && ['en', 'es'].includes(langParam)) {
                currentLang = langParam;
                document.getElementById('langSelect').value = currentLang;
            }
            applyLanguageText(currentLang);
            if (videoId) {
                await loadPlayerView(videoId);
            } else {
                loadHomeView();
            }
        }

        function updateUrlState(id = null) {
            try {
                const newUrl = new URL(window.location);
                if (id) newUrl.searchParams.set('id', id);
                else if (playerView.classList.contains('hidden')) newUrl.searchParams.delete('id');
                newUrl.searchParams.set('lang', currentLang);
                if (id && id !== getIdFromUrl()) window.history.pushState({ path: newUrl.toString() }, '', newUrl.toString());
                else window.history.replaceState({ path: newUrl.toString() }, '', newUrl.toString());
            } catch (e) { }
        }

        async function fetchDailymotion(query, page = 1) {
            const url = `https://api.dailymotion.com/videos?search=${encodeURIComponent(query)}&fields=id,title,thumbnail_720_url,owner.username,views_total,duration&limit=20&page=${page}`;
            try {
                const response = await fetch(url);
                const data = await response.json();
                return data.list || [];
            } catch (error) { return []; }
        }

        function renderCard(video, isSmall = false) {
            const minutes = Math.floor(video.duration / 60);
            const seconds = video.duration % 60;
            const durationStr = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
            const titleClass = isSmall ? "text-xs font-medium line-clamp-2 mt-2 text-gray-200" : "text-sm font-semibold text-gray-100 line-clamp-2 leading-snug group-hover:text-red-500 transition-colors mt-2";

            return `
                <div onclick="openPlayer('${video.id}')" class="group cursor-pointer bg-transparent rounded-lg overflow-hidden transition-all duration-300">
                    <div class="relative aspect-video-card bg-[#1a1a1a] rounded-lg overflow-hidden border border-white/5">
                        <img src="${video.thumbnail_720_url}" alt="${video.title}" class="w-full h-full object-cover group-hover:scale-105 transition duration-500 opacity-90 group-hover:opacity-100">
                        <div class="absolute bottom-1 right-1 bg-black/80 text-white text-[10px] px-1 py-0.5 rounded font-mono">
                            ${durationStr}
                        </div>
                        <div class="absolute inset-0 bg-black/20 group-hover:bg-transparent transition"></div>
                    </div>
                    <h3 class="${titleClass}">${video.title}</h3>
                </div>
            `;
        }

        function renderSideItem(video) {
            return `
                <div onclick="openPlayer('${video.id}')" class="flex gap-3 p-2 rounded-lg hover:bg-[#111] cursor-pointer transition group border border-transparent hover:border-white/5">
                    <div class="relative w-28 aspect-video flex-shrink-0 rounded bg-[#1a1a1a] overflow-hidden">
                        <img src="${video.thumbnail_720_url}" class="w-full h-full object-cover group-hover:opacity-80 transition">
                    </div>
                    <div class="flex flex-col justify-center w-full overflow-hidden">
                        <h4 class="text-xs md:text-sm font-medium text-gray-200 line-clamp-2 group-hover:text-red-400 transition">${video.title}</h4>
                        <div class="flex items-center justify-between mt-1">
                            <p class="text-[10px] text-gray-500 truncate max-w-[80px]">${video['owner.username']}</p>
                            <p class="text-[10px] text-gray-600">${Math.floor(video.duration/60)}m</p>
                        </div>
                    </div>
                </div>
            `;
        }

        async function loadHomeView() {
            homeView.classList.remove('hidden');
            playerView.classList.add('hidden');
            loader.classList.remove('hidden');
            loadMoreBtn.classList.add('hidden');
            mobileSearchContainer.style.display = 'block';
            
            const videos = await fetchDailymotion(currentQuery, currentPage);
            
            let html = '';
            if(videos.length > 0) {
                videos.forEach(v => html += renderCard(v));
                if(currentPage === 1) videoGrid.innerHTML = html;
                else videoGrid.innerHTML += html;
                loadMoreBtn.classList.remove('hidden');
            } else {
                if(currentPage === 1) videoGrid.innerHTML = `<div class="col-span-full text-center text-gray-500 py-10">${CONFIG[currentLang].noResult}</div>`;
            }

            loader.classList.add('hidden');
            refreshIcons(); 
        }

        async function loadMore() {
            currentPage++;
            loadMoreBtn.innerText = CONFIG[currentLang].loading;
            loadMoreBtn.disabled = true;
            await loadHomeView();
            loadMoreBtn.innerText = CONFIG[currentLang].loadMore;
            loadMoreBtn.disabled = false;
        }

        async function loadPlayerView(id) {
            window.scrollTo(0,0);
            homeView.classList.add('hidden');
            mobileSearchContainer.style.display = 'none'; 
            playerView.classList.remove('hidden');

            // Iframe Setting: playsinline=1 & muted=1 (Autoplay di mobile butuh muted)
            dmPlayer.src = `https://www.dailymotion.com/embed/video/${id}?autoplay=1&muted=1&queue-enable=false&playsinline=1&ui-logo=0&ui-start-screen-info=false&sharing-enable=false`;

            try {
                const response = await fetch(`https://api.dailymotion.com/video/${id}?fields=id,title,owner.username,url,views_total`);
                const data = await response.json();
                
                if(data && !data.error) {
                    document.getElementById('playerTitle').innerText = data.title;
                    document.getElementById('playerOwner').innerText = data['owner.username'];
                    document.getElementById('playerViews').innerText = (data.views_total || 0).toLocaleString() + ' views';
                } else {
                    document.getElementById('playerTitle').innerText = "Video Played from ID";
                }
            } catch(e) { console.log("Metadata error:", e); }

            loadRecommendations(id);
        }

        async function loadRecommendations(currentId) {
            const listDesktop = document.getElementById('recommendationListDesktop');
            const listMobile = document.getElementById('recommendationListMobile');
            
            const loadingHtml = `<div class="col-span-full text-center py-4 text-gray-600 text-sm animate-pulse">${CONFIG[currentLang].loading}</div>`;
            listDesktop.innerHTML = loadingHtml;
            listMobile.innerHTML = loadingHtml;
            
            const randomPage = Math.floor(Math.random() * 5) + 1;
            const recVideos = await fetchDailymotion(CONFIG[currentLang].query, randomPage);
            
            let htmlDesktop = '';
            let htmlMobile = '';
            
            recVideos.filter(v => v.id !== currentId).slice(0, 10).forEach(v => { 
                htmlDesktop += renderSideItem(v);
                htmlMobile += renderCard(v, true);
            });
            
            listDesktop.innerHTML = htmlDesktop || '<div class="text-center text-xs text-gray-600">No recommendations</div>';
            listMobile.innerHTML = htmlMobile || '<div class="col-span-full text-center text-xs text-gray-600">No recommendations</div>';
            
            refreshIcons();
        }

        function openPlayer(id) {
            updateUrlState(id);
            loadPlayerView(id);
        }

        function goHome() {
            try {
                const newUrl = new URL(window.location);
                newUrl.searchParams.delete('id');
                newUrl.searchParams.set('lang', currentLang); 
                window.history.pushState({ path: newUrl.toString() }, '', newUrl.toString());
            } catch (e) { }
            
            dmPlayer.src = "";
            homeView.classList.remove('hidden');
            playerView.classList.add('hidden');
            mobileSearchContainer.style.display = 'block';
        }
        
        function getIdFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('id');
        }

        function shareVideo() {
            const url = window.location.href;
            navigator.clipboard.writeText(url).then(() => {
                alert(CONFIG[currentLang].copied);
            }).catch(err => { console.error('Failed to copy: ', err); });
        }

        function handleSearch(e) {
            e.preventDefault();
            let q = document.getElementById('searchInput').value;
            if(!q) q = document.getElementById('searchInputMobile').value;
            q = q.trim();
            if(!q) return;

            const isDailymotionID = /^[xXkK][a-zA-Z0-9]{5,8}$/.test(q);

            if (isDailymotionID) {
                openPlayer(q);
                document.getElementById('searchInput').value = '';
                document.getElementById('searchInputMobile').value = '';
            } else {
                currentQuery = q;
                currentPage = 1;
                isSearchMode = true;
                pageTitle.innerText = `ðŸ” ${q}`;
                goHome(); 
                videoGrid.innerHTML = ''; 
                loadHomeView();
            }
        }

        document.getElementById('searchForm').addEventListener('submit', handleSearch);
        document.getElementById('searchFormMobile').addEventListener('submit', handleSearch);

        window.onpopstate = function(event) {
            const id = getIdFromUrl();
            if(id) loadPlayerView(id);
            else {
                dmPlayer.src = "";
                homeView.classList.remove('hidden');
                playerView.classList.add('hidden');
                mobileSearchContainer.style.display = 'block';
            }
        };

        document.addEventListener('DOMContentLoaded', () => {
            init();
        });

    </script>
</body>
</html>
