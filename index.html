<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Drama Gratis - Nonton Tanpa Batas</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root { --primary-color: #e50914; --bg-color: #141414; --card-bg: #1f1f1f; }
        body { background-color: var(--bg-color); color: #fff; font-family: 'Poppins', sans-serif; padding-bottom: 60px; }
        
        /* Navbar */
        .navbar { background-color: rgba(0,0,0,0.95) !important; border-bottom: 1px solid #333; }
        .btn-search { background-color: var(--primary-color); color: white; border: none; }
        .btn-search:hover { background-color: #b20710; color: white; }

        /* Card Drama */
        .drama-card { background-color: var(--card-bg); border-radius: 8px; overflow: hidden; transition: transform 0.3s ease; cursor: pointer; height: 100%; position: relative; border: 1px solid #333; }
        .drama-card:hover { transform: scale(1.03); z-index: 2; border-color: var(--primary-color); }
        .card-img-wrapper { position: relative; padding-top: 140%; /* Rasio Poster */ }
        .card-img-top { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; }
        .card-body { padding: 10px; }
        .drama-title { font-size: 0.9rem; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        
        /* Modal Player */
        .modal-content { background-color: #181818; color: white; border: 1px solid #444; }
        .modal-header { border-bottom: 1px solid #333; }
        .modal-footer { border-top: 1px solid #333; }
        .plyr { border-radius: 0; }
        .episode-list { max-height: 200px; overflow-y: auto; scrollbar-width: thin; }
        .btn-eps { background: #2a2a2a; color: #ddd; border: 1px solid #444; margin: 3px; font-size: 0.85rem; width: 50px; border-radius: 4px; }
        .btn-eps:hover, .btn-eps.active { background: var(--primary-color); border-color: var(--primary-color); color: #fff; }

        /* Ads Container Styles */
        .native-ad-container { 
            background: #000; 
            padding: 10px; 
            margin-top: 15px; 
            border-radius: 6px; 
            min-height: 100px; 
            display: flex; 
            align-items: center; 
            justify-content: center;
            border: 1px dashed #444;
        }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-dark sticky-top">
        <div class="container">
            <a class="navbar-brand fw-bold text-danger" href="#"><i class="fas fa-play-circle me-2"></i>DRAMAKU</a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse mt-2 mt-lg-0" id="navbarNav">
                <div class="d-flex w-100 gap-2 flex-column flex-lg-row">
                    <input id="searchInput" class="form-control bg-dark text-white border-secondary" type="search" placeholder="Cari judul drama (Contoh: CEO)...">
                    <button class="btn btn-search" type="button" onclick="handleSearch()">Cari</button>
                    <a href="https://thinnerwithdrewforbear.com/hwb3cmd6y?key=1c3f46a40e0e5deafd89c38ccc6afb86" target="_blank" class="btn btn-outline-light text-nowrap">
                        <i class="fas fa-download me-1"></i> App
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <div class="container py-4">
        
        <h5 class="mb-4 text-white border-start border-4 border-danger ps-2" id="sectionTitle">
            <i class="fas fa-fire me-2 text-warning"></i>Hasil Pencarian
        </h5>
        
        <div id="loading" class="text-center py-5 d-none">
            <div class="spinner-border text-danger" role="status"></div>
            <p class="mt-2 text-muted small">Mengambil data dari server...</p>
        </div>

        <div id="dramaGrid" class="row row-cols-2 row-cols-md-4 row-cols-lg-5 g-3">
            <div class="col-12 text-center text-muted py-5">
                <i class="fas fa-search fa-3x mb-3 text-secondary"></i><br>
                Silakan ketik judul drama di kolom pencarian.
            </div>
        </div>
    </div>

    <div class="modal fade" id="playerModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header py-2">
                    <h6 class="modal-title text-truncate w-75" id="modalTitle">Loading...</h6>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" onclick="stopPlayer()"></button>
                </div>
                <div class="modal-body p-0 bg-black position-relative">
                    <video id="player" playsinline controls class="w-100" style="max-height: 50vh;"></video>
                </div>
                <div class="modal-footer d-block pt-2">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <small class="text-muted">Pilih Episode:</small>
                        <a href="https://thinnerwithdrewforbear.com/hwb3cmd6y?key=1c3f46a40e0e5deafd89c38ccc6afb86" target="_blank" class="badge bg-success text-decoration-none">
                            <i class="fas fa-bolt"></i> Fast Server
                        </a>
                    </div>
                    
                    <div id="episodeContainer" class="episode-list d-flex flex-wrap justify-content-start">
                        </div>

                    <div class="native-ad-container">
                        <script async="async" data-cfasync="false" src="https://thinnerwithdrewforbear.com/54f40a4ce292a9187e0b9a0feb507f92/invoke.js"></script>
                        <div id="container-54f40a4ce292a9187e0b9a0feb507f92"></div>
                    </div>
                    </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.plyr.io/3.7.8/plyr.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    
    <script src="https://thinnerwithdrewforbear.com/2e/a1/21/2ea12153a74996b501c2507cb4eebc96.js"></script>
    
    <script src="https://thinnerwithdrewforbear.com/90/6b/c8/906bc8f65d5da8ba2ea29c2fb6a38424.js"></script>

    <script>
        // Setup API & Proxy
        // Menggunakan daftar proxy rotasi untuk menghindari limit
        const PROXY_LIST = [
            "https://corsproxy.io/?",
            "https://api.allorigins.win/raw?url="
        ];
        let currentProxyIndex = 0;
        const API_BASE = "https://api.sansekai.my.id/api/dramabox";
        
        let player = null;

        document.addEventListener('DOMContentLoaded', () => {
            player = new Plyr('#player', {
                controls: ['play-large', 'play', 'progress', 'current-time', 'mute', 'volume', 'fullscreen'],
                ratio: '9:16' // Rasio umum drama pendek (vertikal)
            });
        });

        function getProxy() {
            return PROXY_LIST[currentProxyIndex];
        }

        function switchProxy() {
            currentProxyIndex = (currentProxyIndex + 1) % PROXY_LIST.length;
            console.log("Switching proxy to:", PROXY_LIST[currentProxyIndex]);
        }

        async function handleSearch() {
            const query = document.getElementById('searchInput').value;
            if(!query) return alert("Masukkan kata kunci!");

            showLoading(true);
            const grid = document.getElementById('dramaGrid');
            grid.innerHTML = ""; 

            try {
                // Encode URL dengan benar
                const targetUrl = `${API_BASE}/search?query=${encodeURIComponent(query)}`;
                const finalUrl = getProxy() + encodeURIComponent(targetUrl);
                
                const response = await fetch(finalUrl);
                if(!response.ok) throw new Error("Network response was not ok");
                
                const json = await response.json();
                const results = json.data || json;

                if (!results || results.length === 0) {
                    grid.innerHTML = '<div class="col-12 text-center text-muted">Tidak ada drama ditemukan.</div>';
                } else {
                    results.forEach(item => {
                        const thumb = item.thumbnail || 'https://via.placeholder.com/300x450?text=No+Cover';
                        const title = item.title || 'Tanpa Judul';
                        
                        const html = `
                            <div class="col">
                                <div class="drama-card" onclick="loadDramaDetail('${item.url}')">
                                    <div class="card-img-wrapper">
                                        <img src="${thumb}" class="card-img-top" alt="${title}" loading="lazy">
                                        <div class="position-absolute bottom-0 start-0 w-100 p-2 text-center" style="background: linear-gradient(transparent, black);">
                                            <small class="text-white"><i class="fas fa-play"></i> Nonton</small>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div class="drama-title">${title}</div>
                                    </div>
                                </div>
                            </div>
                        `;
                        grid.innerHTML += html;
                    });
                }

            } catch (error) {
                console.error(error);
                switchProxy(); // Coba proxy lain jika gagal next time
                grid.innerHTML = '<div class="col-12 text-center text-danger">Gagal mengambil data. Coba lagi atau gunakan VPN.</div>';
            } finally {
                showLoading(false);
            }
        }

        async function loadDramaDetail(dramaUrl) {
            const myModal = new bootstrap.Modal(document.getElementById('playerModal'));
            myModal.show();
            
            document.getElementById('modalTitle').innerText = "Memuat detail...";
            document.getElementById('episodeContainer').innerHTML = '<div class="p-3 text-center"><span class="spinner-border spinner-border-sm text-danger"></span></div>';
            
            if(player) player.stop();

            try {
                const targetUrl = `${API_BASE}/detail?url=${dramaUrl}`;
                const finalUrl = getProxy() + encodeURIComponent(targetUrl);
                
                const response = await fetch(finalUrl);
                const json = await response.json();
                const data = json.data || json;

                document.getElementById('modalTitle').innerText = data.title;
                const epsContainer = document.getElementById('episodeContainer');
                epsContainer.innerHTML = "";

                if(data.episode_list && data.episode_list.length > 0) {
                    playSource(data.episode_list[0].url);

                    data.episode_list.forEach((eps, index) => {
                        const btn = document.createElement('button');
                        btn.className = 'btn btn-eps';
                        btn.innerText = index + 1;
                        btn.onclick = () => {
                            document.querySelectorAll('.btn-eps').forEach(b => b.classList.remove('active'));
                            btn.classList.add('active');
                            playSource(eps.url);
                        };
                        if(index === 0) btn.classList.add('active');
                        epsContainer.appendChild(btn);
                    });
                } else {
                    epsContainer.innerHTML = "<small class='text-danger'>Tidak ada episode ditemukan.</small>";
                }

            } catch (error) {
                console.error("Detail Error:", error);
                document.getElementById('modalTitle').innerText = "Error";
                document.getElementById('episodeContainer').innerText = "Gagal memuat detail.";
            }
        }

        function playSource(sourceUrl) {
            // Deteksi format m3u8
            if (Hls.isSupported() && sourceUrl.includes('.m3u8')) {
                const hls = new Hls();
                hls.loadSource(sourceUrl);
                hls.attachMedia(document.getElementById('player'));
                hls.on(Hls.Events.MANIFEST_PARSED, function() {
                    player.play();
                });
            } else {
                document.getElementById('player').src = sourceUrl;
                player.play();
            }
        }

        function stopPlayer() {
            if(player) player.stop();
        }

        function showLoading(show) {
            const loader = document.getElementById('loading');
            if(show) loader.classList.remove('d-none');
            else loader.classList.add('d-none');
        }

        document.getElementById('searchInput').addEventListener("keypress", function(event) {
            if (event.key === "Enter") {
                event.preventDefault();
                handleSearch();
            }
        });
    </script>

    <script type="text/javascript">var _Hasync= _Hasync|| [];
    _Hasync.push(['Histats.start', '1,4889367,4,0,0,0,00010000']);
    _Hasync.push(['Histats.fasi', '1']);
    _Hasync.push(['Histats.track_hits', '']);
    (function() {
    var hs = document.createElement('script'); hs.type = 'text/javascript'; hs.async = true;
    hs.src = ('//s10.histats.com/js15_as.js');
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(hs);
    })();</script>
    <noscript><a href="/" target="_blank"><img  src="//sstatic1.histats.com/0.gif?4889367&101" alt="" border="0"></a></noscript>
    </body>
</html>
